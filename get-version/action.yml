name: "Get version"
description: "Use CMake to get the version"

outputs:
  version:
    description: "Version number generated by CMake"
    value: ${{ steps.get-version.outputs.version }}

runs:
  using: "composite"

  steps:
      - name: Constants
        id: constants
        run: |
          echo "version-file=build/VERSION" >> $GITHUB_OUTPUT
        shell: bash

      - name: Save version
        run: |
          cmake --log-level VERBOSE \
          -DVERSION_FILE=${{ steps.constants.outputs.version-file }} \
          -P ext/synergy-extra/cmake/SaveVersion.cmake
        shell: bash

      - name: Get version
        id: get-version
        run: |
          version_file="${{ steps.constants.outputs.version-file }}"
          version=$(cat $version_file)
          if [[ -z "$version" ]]; then
            echo "File is empty: $version_file"
            exit 1
          fi

          echo "Version: $version"
          echo "version=$version" >> $GITHUB_OUTPUT
        shell: bash
